module.exports = Object.assign(extend, {
    options: ['--username', '--directory', '--subdomain', '--passcode'],
    flags: ['--wsdl', '--templates', '--force'],
    shortcuts: ['-u', '-d', '-s', '-p'],
    help: `
# SYNOPSIS

    *cds extend* [ <url> ]

   Create an extension project from url [url]


# OPTIONS

    *-d* | *--directory* <directory>
    
        The target directory.

    *-s* | *--subdomain* <subdomain>
    
        The subdomain to extend.
        
    *-p* | *--passcode* <passcode>
    
        The passcode for authentication

    *-u* | *--username* <name> 

        Deprecated. Use passcode parameter instead.
    
        *--force*

        Overwrite existing content. Make sure you are using a version control system (like git) to avoid data loss.

    *--templates*
    
        Download templates   
        
`})


async function extend ([url], options = {}) {

    try {
        const client = require('@sap/cds-sidecar-client')
        const askQuestion = client.question.askQuestion
        const askBooleanQuestion = client.question.askBooleanQuestion

        if (options.username && !options.passcode) {
            options.password = await askQuestion('Password: ', undefined, true)
        }

        if (options.force) {
            if(!await askBooleanQuestion('Using option --force will overwrite extisting files. Continue (yN)? ', false, false)) {
                console.log('Extend cancelled')
                return;
            }
        }

        client.extend(url, options)
    } catch (e) {
        console.log('This feature requires cds-sidecar-client to be installed')
    }

}



/* eslint no-console: off */
