const to = service => {
  const cds = require('../../cds')
  const OData = require('./OData')
  const Dispatcher = require('./Dispatcher')

  const odata = new OData(
    cds,
    cds.compile.to.edm(service._csn, { service: service.options.service, version: 'v4' }),
    service._csn,
    service.options
  )
  odata.addCDSServiceToChannel(service)

  return new Dispatcher(odata).getService()
}

module.exports = to
