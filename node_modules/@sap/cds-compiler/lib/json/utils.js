'use strict'

// Utility functions for JSON processing

// Convert obj to a normalized JSON string (where properties are sorted alphabetically).
function normalizeJSON(obj) {
  if (typeof obj == 'string') {
    obj = JSON.parse(obj);
  }
  return JSON.stringify(obj, orderProperties, 2);
}

// JSON 'reviver' function that orders its properties alphabetically
function orderProperties( _key, val ) {
  if (!val || typeof val !== 'object' || val instanceof Array)
    return val;

  // actual JSON.stringify implementations output properties of object in
  // sequence as they are set -> return copy of object
  let r = Object.create( Object.getPrototypeOf(val) );
  for (let key of Object.keys(val).sort())
    r[key] = val[key];
  return r;
}

module.exports = {
  normalizeJSON,
  orderProperties,
}

