const _sameElements = (elements1, elements2) => {
  if (Object.keys(elements1).length !== Object.keys(elements2).length) {
    return false
  }

  for (const key of Object.keys(elements1)) {
    if (!elements2[key]) {
      return false
    }

    const element1 = elements1[key]
    const element2 = elements2[key]

    if (element1.name !== element2.name || element1.kind !== element2.kind || element1.type !== element2.type) {
      return false
    }
  }

  return true
}

// Workaround until the kind of select view is changed from 'view' to 'entity'
// OLD CSN - TODO: remove it if no support for old csn
const isSelectEntity = (obj, { definitions }) => {
  if (obj.kind === 'view' && obj.source) {
    if (obj.query && !obj.query.where && _sameElements(obj.elements, definitions[obj.source].elements)) {
      return true
    }
  }

  return false
}

module.exports = isSelectEntity
