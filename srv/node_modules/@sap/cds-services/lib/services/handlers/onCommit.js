module.exports = context => {
  if (!context._.shared.connections) {
    return null
  }

  if (context._.shared.connections.size === 1) {
    return context._.shared.connections
      .values()
      .next()
      .value.commit()
  }

  const commits = []

  for (const transaction of context._.shared.connections.values()) {
    commits.push(transaction.commit())
  }

  return Promise.all(commits)
}
