const EventEmitter = require('events')

class MockEMClient extends EventEmitter {
  constructor (options) {
    super()
    this._options = options
  }

  disconnect () {
    this.emit('disconnected')
    return Promise.resolve(this)
  }

  sender (key) {
    return this
  }

  attach (target) {
    return this
  }

  write (msg) {
    this.emit('data', {
      done: () => {},
      failed: () => {},
      payload: { chunks: [msg.payload] },
      source: {
        properties: {
          subject: msg.target.properties.to.replace('topic:', '')
        }
      }
    })
  }

  receiver () {
    return this
  }

  end () {
    return this
  }

  connect () {
    this.emit('connected')
    return this
  }

  addSubscription (topic) {
    return this
  }
}

module.exports = MockEMClient
