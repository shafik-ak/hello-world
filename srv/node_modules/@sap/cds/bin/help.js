module.exports = exports = Object.assign (help, {help:`
# USAGE

    *cds* <command> [<args>]
    *cds* <src>  =  *cds compile* <src>
    *cds*        =  *cds help*

# COMMANDS

    *i* | *init*       jump-start cds-based projects
    *c* | *compile*    process models selectively
    *d* | *deploy*     e.g. to databases or cloud
    *s* | *serve*      run servers locally
    *w* | *watch*      restart server on file changes
    *m* | *import*     add models from external sources
    *r* | *repl*       read-eval-event loop
    *e* | *env*        get/set cds configuration
    *b* | *build*      prepare for deployment
    *v* | *version*    get detailed version information
    *?* | *help*       get detailed usage information

  Learn more about each with:
  *cds help* <command> or
  *cds* <command> *?*

`})

exports.with = (taskLoader, ...shortcuts) => {
  help._load = taskLoader  // this is to have the require task logic only once
  return Object.assign (help, ...shortcuts)
}

function help (topic) {
  const { format } = require('./utils/term')
  if (Array.isArray(topic))  topic = topic[0]
  let txt = !topic ? help.help : _help4(topic)
  if (txt)  return console.log (format.poorMarkdown (txt))
  throw new Error(`Didn't find a help topic for '${ topic._name || topic.name || topic }'.`)
}

function _help4 (cmd) {
  if (cmd && typeof cmd !== 'string') return cmd.help
  if (cmd in help)  cmd = help[cmd]  // i.e. shortcuts we got from CLI
  const task = help._load (cmd)
  if (task)  return task.help
}

/* eslint no-console: off */
if (!module.parent)  help (['init'])